# ------------------------------------------------------
# ğŸ§ª CI - Lint, Test, Typecheck, Build
# ------------------------------------------------------
# main ë¸Œëœì¹˜ì— ì½”ë“œê°€ pushë˜ê±°ë‚˜, PRì´ ìƒì„±ë  ë•Œë§ˆë‹¤ ì‹¤í–‰
# ì½”ë“œ í’ˆì§ˆ ê²€ì¦ (lint â†’ typecheck â†’ test â†’ build) ëª©ì 
# ------------------------------------------------------

name: ğŸ§ª CI - Lint, Test, Typecheck, Build

on:
  push:
    branches: [main] # main ë¸Œëœì¹˜ë¡œ pushë  ë•Œë§ˆë‹¤ ì‹¤í–‰
  pull_request:
    branches: [main] # main ë¸Œëœì¹˜ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” PRë„ ì‹¤í–‰

jobs:
  validate:
    name: ğŸ§° Validate & Build
    runs-on: ubuntu-latest # GitHub Actions Runner OS (ë¦¬ëˆ…ìŠ¤ ìµœì‹  ë²„ì „)

    steps:
      # ------------------------------------------------------
      # 1ï¸âƒ£ ë¦¬í¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
      # - í˜„ì¬ ë¦¬í¬ì§€í† ë¦¬ì˜ ì½”ë“œë¥¼ runner í™˜ê²½ì— ë‹¤ìš´ë¡œë“œ
      # ------------------------------------------------------
      - name: ğŸ“‚ Checkout Repository
        uses: actions/checkout@v4

      # ------------------------------------------------------
      # 2ï¸âƒ£ PNPM ì„¸íŒ…
      # - CI í™˜ê²½ì— pnpm ì„¤ì¹˜
      # ------------------------------------------------------
      - name: ğŸ› ï¸ Setup PNPM
        uses: pnpm/action-setup@v4
        with:
          version: 10.19.0 # package.json > engines.pnpm

      # ------------------------------------------------------
      # 3ï¸âƒ£ Node.js í™˜ê²½ ì„¤ì •
      # - Node 20 + pnpm ìºì‹œ êµ¬ì„±
      # ------------------------------------------------------
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20 # .nvmrcì— ëª…ì‹œëœ Node ë²„ì „ (>=20)
          cache: 'pnpm' # ì†ë„ í–¥ìƒ

      # ------------------------------------------------------
      # 4ï¸âƒ£ ì˜ì¡´ì„± ì„¤ì¹˜
      # - pnpm-lock.yaml ê¸°ì¤€ìœ¼ë¡œ ì„¤ì¹˜ (ë²„ì „ ì¼ê´€ì„± ë³´ì¥)
      # ------------------------------------------------------
      - name: ğŸ“¦ Install Dependencies
        run: pnpm install --frozen-lockfile

      # ------------------------------------------------------
      # 5ï¸âƒ£ ë¦°íŠ¸ ê²€ì‚¬ (ESLint + Stylelint)
      # ------------------------------------------------------
      - name: ğŸ” Lint (ESLint + Stylelint)
        run: pnpm lint

      # ------------------------------------------------------
      # 6ï¸âƒ£ íƒ€ì… ì²´í¬ (TypeScript)
      # - --noEmit: ì‹¤ì œ ë¹Œë“œ ì—†ì´ íƒ€ì… ê²€ì‚¬ ìˆ˜í–‰
      # ------------------------------------------------------
      - name: ğŸ§© Type Check (tsc)
        run: pnpm typecheck

      # ------------------------------------------------------
      # 7ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (unit + ui)
      #  - ë¡œì§/ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ + UI í…ŒìŠ¤íŠ¸ ëª¨ë‘ ìˆ˜í–‰
      # ------------------------------------------------------
      - name: ğŸ§ª Run Tests (unit + ui)
        run: pnpm test

      # ------------------------------------------------------
      # 8ï¸âƒ£ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¹Œë“œ (tsup)
      # - ë°°í¬ ì „ ë¹Œë“œ ì˜¤ë¥˜ ê²€ì¦ ëª©ì 
      # ------------------------------------------------------
      - name: ğŸ—ï¸ Build Library
        run: pnpm build:lib

      # ------------------------------------------------------
      # 9ï¸âƒ£ ìš”ì•½ ì¶œë ¥
      # - ëª¨ë“  ë‹¨ê³„ê°€ í†µê³¼ ì‹œ, ìµœì¢… ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
      # ------------------------------------------------------
      - name: âœ… Summary
        run: echo "ğŸ‰ CI passed successfully!"
